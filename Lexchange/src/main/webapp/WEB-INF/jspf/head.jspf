<!DOCTYPE html>
<%@ page contentType="text/html;charset=UTF-8" language="java" pageEncoding="UTF-8" %>

<html lang="en">
<head>
    <title>
        ${title}
    </title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <link href="resources/css/bootstrap.min.css" rel="stylesheet">
    <link href="resources/css/font-awesome.min.css" rel="stylesheet">
    <link href="resources/css/animate.min.css" rel="stylesheet">
    <link href="resources/css/lightbox.css" rel="stylesheet">
    <link href="resources/css/main.css" rel="stylesheet">
    <link href="resources/css/responsive.css" rel="stylesheet">

    <!--[if lt IE 9]>
    <script src="/resources/js/html5shiv.js"></script>
    <script src="/resources/js/respond.min.js"></script>
    <![endif]-->
    <link rel="shortcut icon" href="resources/images/ico/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="144x144"
          href="resources/images/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114"
          href="resources/images/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72"
          href="resources/images/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="resources/images/ico/apple-touch-icon-57-precomposed.png">


    <script type="text/javascript" src="resources/js/jquery.js"></script>
    <script type="text/javascript" src="resources/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="resources/js/jquery.isotope.min.js"></script>
    <script type="text/javascript" src="resources/js/lightbox.min.js"></script>
    <script type="text/javascript" src="resources/js/wow.min.js"></script>
    <script type="text/javascript" src="resources/js/jquery.countTo.js"></script>
    <script type="text/javascript" src="resources/js/main.js"></script>
    <script type="text/javascript" src="resources/js/knockout-3.4.2.js"></script>
    <script type="text/javascript" src="resources/js/chat.js"></script>


    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <c:if test="${not empty regions}">
        <script type="text/javascript">
            google.charts.load('current', {'packages': ['geochart']});
            google.charts.setOnLoadCallback(drawRegionsMap);

            function drawRegionsMap() {

                var data = google.visualization.arrayToDataTable([
                    ['<spring:message code="country"/>', '<spring:message code="members"/>'],
                    <c:forEach var="elem" items="${regions.entrySet()}">
                    ['${elem.getKey()}', ${elem.getValue()}],
                    </c:forEach>
                ]);

                var options = {colorAxis: {minValue: 0, colors: ['#f5f5f5', '#4fcccd']}};

                var chart = new google.visualization.GeoChart(document.getElementById('regions_div'));

                function myClickHandler() {
                    var selectionIdx = chart.getSelection()[0].row;
                    var stateName = data.getValue(selectionIdx, 0);
                    location.href = 'search?country=' + stateName;
                }

                google.visualization.events.addListener(chart, 'select', myClickHandler);

                chart.draw(data, options);
            }
        </script>
    </c:if>
    <c:if test="${not empty complains}">
        <script type="text/javascript">
            google.charts.load('current', {'packages': ['table']});
            google.charts.setOnLoadCallback(drawTable);

            function drawTable() {
                var data = new google.visualization.DataTable();
                data.addColumn('number', 'ID');
                data.addColumn('string', '<spring:message code="name"/>');
                data.addColumn('string', '<spring:message code="email"/>');
                data.addColumn('string', '<spring:message code="birth.date"/>');
                data.addColumn('boolean', '<spring:message code="avatar"/>');
                data.addColumn('string', '<spring:message code="action"/>');
                data.addRows([
                    <c:forEach var="elem" items="${complains}">
                    <c:set var="flink" value='location.href="forgive?id=${elem.getAppUser().getId()}"; return false;'/>
                    <c:set var="plink" value='location.href="punish?id=${elem.getAppUser().getId()}"; return false;'/>
                    [${elem.getAppUser().getId()}, '${elem.getAppUser().getFirstName()} ${elem.getAppUser().getLastName()}',
                        '${elem.getAppUser().getEmail()}', '${elem.getAppUser().getBirthDate()}', ${not empty elem.getAppUser().getUrl()},
                    '<div class="align-center"><button type="button" class="btn btn-xs btn-success" onclick=${flink}><i class="fa fa-thumbs-o-up"></i> <spring:message code="forgive"/></button>' +
                    ' <button type="button" class="btn btn-xs btn-danger" onclick=${plink}><i class="fa fa-thumbs-o-down"></i> <spring:message code="punish"/></button></div>'],
                    </c:forEach>
                ]);

                var table = new google.visualization.Table(document.getElementById('table_div'));

                table.draw(data, {allowHtml: true, width: '80%', height: '100%'});
            }
        </script>
    </c:if>

</head>
